// Drools Business Rules for Tyotapaturma ja ammattitautilaki
// Law: 459/2015
// Generated from DMN rules
// Total decisions: 10

package fi.law.tyotapaturma_ja_ammattitautilaki

import java.math.BigDecimal;
import java.util.Date;
import java.util.List;
import java.util.ArrayList;

// Context fact for rule evaluation
declare Context
    result : Object
    legalBasis : String
    sourceText : String
    // Dynamic fields
end

// ========== DECISION TABLES ==========

// Decision: InsuranceObligation
// Description: Determine if employer has mandatory insurance obligation
// Legal Source: Part I, Sections 1-14
// Inputs: person.type, person.employment_status
// Output: insurance_required

rule "InsuranceObligation_1"
    when
    $ctx : Context(person_type == "Employee", person_employment_status == "employed")
    then
    $ctx.setResult("MandatoryInsurance");
    $ctx.setLegalBasis("Section 3(1)");
    $ctx.setSourceText("Työnantajan on otettava vakuutus");
end

rule "InsuranceObligation_2"
    when
    $ctx : Context(person_type == "Employee", person_employment_status == "probation")
    then
    $ctx.setResult("MandatoryInsurance");
    $ctx.setLegalBasis("Section 3(1)");
    $ctx.setSourceText("Koeaikana vakuutusvelvollisuus");
end

rule "InsuranceObligation_3"
    when
    $ctx : Context(person_type == "Employee", person_employment_status == "contract")
    then
    $ctx.setResult("MandatoryInsurance");
    $ctx.setLegalBasis("Section 3(2)");
    $ctx.setSourceText("Työsopimuksen perusteella");
end

rule "InsuranceObligation_4"
    when
    $ctx : Context(person_type == "Entrepreneur", person_employment_status == "YEL_insured")
    then
    $ctx.setResult("VoluntaryWorkTimeInsurance");
    $ctx.setLegalBasis("Sections 188-190");
    $ctx.setSourceText("Yrittäjän vapaaehtoinen vakuutus");
end

rule "InsuranceObligation_5"
    when
    $ctx : Context(person_type == "Farmer", person_employment_status != null)
    then
    $ctx.setResult("Excluded");
    $ctx.setLegalBasis("Section 11");
    $ctx.setSourceText("Maa- ja metsätalousyrittäjät");
end

rule "InsuranceObligation_6"
    when
    $ctx : Context(person_type == "ForeignWorker", person_employment_status == "EU")
    then
    $ctx.setResult("MandatoryInsurance");
    $ctx.setLegalBasis("Section 8(1)");
    $ctx.setSourceText("EU-kansalaiset");
end

rule "InsuranceObligation_7"
    when
    $ctx : Context(person_type == "ForeignWorker", person_employment_status == "non_EU")
    then
    $ctx.setResult("Check bilateral");
    $ctx.setLegalBasis("Section 8(2)");
    $ctx.setSourceText("Kolmansien maiden kansalaiset");
end

// Decision: CompensableEvent
// Description: Determine if event is compensable under the law
// Legal Source: Part II, Sections 15-35
// Inputs: event.type, event.location, event.timing
// Output: compensable

rule "CompensableEvent_1"
    when
    $ctx : Context(event_type == "WorkplaceAccident", event_location == "workplace", event_timing == "during_work")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 17(1)");
    $ctx.setSourceText("Työtapaturma");
end

rule "CompensableEvent_2"
    when
    $ctx : Context(event_type == "WorkplaceAccident", event_location == "workplace", event_timing == "before_after")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 18");
    $ctx.setSourceText("Muut vammat");
end

rule "CompensableEvent_3"
    when
    $ctx : Context(event_type == "WorkplaceAccident", event_location == "workplace", event_timing == "breaks")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 17(3)");
    $ctx.setSourceText("Tauolla");
end

rule "CompensableEvent_4"
    when
    $ctx : Context(event_type == "CommuteAccident", event_location == "home_work_route", event_timing == "direct_route")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 21(1)");
    $ctx.setSourceText("Kotimatkan aikana");
end

rule "CompensableEvent_5"
    when
    $ctx : Context(event_type == "CommuteAccident", event_location == "home_work_route", event_timing == "detour_necessary")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 21(2)");
    $ctx.setSourceText("Välttämätön kiertotie");
end

rule "CompensableEvent_6"
    when
    $ctx : Context(event_type == "CommuteAccident", event_location == "home_work_route", event_timing == "detour_personal")
    then
    $ctx.setResult("Not compensable");
    $ctx.setLegalBasis("Section 21(3)");
    $ctx.setSourceText("Oma-aloitteinen kiertotie");
end

rule "CompensableEvent_7"
    when
    $ctx : Context(event_type == "BusinessTripAccident", event_location == "work_travel", event_timing == "during_travel")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 22");
    $ctx.setSourceText("Työmatkalla");
end

rule "CompensableEvent_8"
    when
    $ctx : Context(event_type == "BusinessTripAccident", event_location == "accommodation", event_timing != null)
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 23");
    $ctx.setSourceText("Majoituksen aikana");
end

rule "CompensableEvent_9"
    when
    $ctx : Context(event_type == "BusinessTripAccident", event_location == "free_time", event_timing == "during_trip")
    then
    $ctx.setResult("Limited");
    $ctx.setLegalBasis("Section 24");
    $ctx.setSourceText("Vapaa-aikana");
end

rule "CompensableEvent_10"
    when
    $ctx : Context(event_type == "OccupationalDisease", event_location != null, event_timing == "diagnosed")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 26(1)");
    $ctx.setSourceText("Ammattitauti");
end

rule "CompensableEvent_11"
    when
    $ctx : Context(event_type == "RepetitiveStrainInjury", event_location != null, event_timing != null)
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 33");
    $ctx.setSourceText("Yksipuolinen kuormitus");
end

rule "CompensableEvent_12"
    when
    $ctx : Context(event_type == "ViolenceIncident", event_location == "work_related", event_timing == "during_work")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 34");
    $ctx.setSourceText("Väkivalta");
end

rule "CompensableEvent_13"
    when
    $ctx : Context(event_type == "PsychologicalInjury", event_location == "work_related", event_timing == "serious")
    then
    $ctx.setResult("Compensable");
    $ctx.setLegalBasis("Section 35");
    $ctx.setSourceText("Psykografkinen sairaus");
end

// Decision: CompensationType
// Description: Determine type of compensation based on injury
// Legal Source: Part III, Sections 36-109
// Inputs: injury.type, injury.severity, injury.duration
// Output: compensation_type

rule "CompensationType_1"
    when
    $ctx : Context(injury_type == "PhysicalInjury", injury_severity == "minor", injury_duration == "< 1 year")
    then
    $ctx.setResult("MedicalExpenses");
    $ctx.setLegalBasis("Section 36");
    $ctx.setSourceText("Sairaanhoito");
end

rule "CompensationType_2"
    when
    $ctx : Context(injury_type == "PhysicalInjury", injury_severity == "moderate", injury_duration == "1-3 years")
    then
    $ctx.setResult("MedicalExpenses + LostWages");
    $ctx.setLegalBasis("Sections 36, 55");
    $ctx.setSourceText("Sairaanhoito + ansionmenetys");
end

rule "CompensationType_3"
    when
    $ctx : Context(injury_type == "PhysicalInjury", injury_severity == "severe", injury_duration == "> 3 years")
    then
    $ctx.setResult("MedicalExpenses + LostWages + Disability");
    $ctx.setLegalBasis("Sections 36, 55, 83");
    $ctx.setSourceText("Kokonaiskorvaus");
end

rule "CompensationType_4"
    when
    $ctx : Context(injury_type == "PhysicalInjury", injury_severity == "permanent", injury_duration != null)
    then
    $ctx.setResult("PermanentDisabilityCompensation");
    $ctx.setLegalBasis("Section 83(1)");
    $ctx.setSourceText("Pysyvä haitta");
end

rule "CompensationType_5"
    when
    $ctx : Context(injury_type == "OccupationalDisease", injury_severity != null, injury_duration != null)
    then
    $ctx.setResult("MedicalExpenses + LostWages");
    $ctx.setLegalBasis("Sections 26-32");
    $ctx.setSourceText("Ammattitaudin korvaus");
end

rule "CompensationType_6"
    when
    $ctx : Context(injury_type == "MentalInjury", injury_severity == "moderate", injury_duration != null)
    then
    $ctx.setResult("Rehabilitation");
    $ctx.setLegalBasis("Section 88(1)");
    $ctx.setSourceText("Kuntoutus");
end

rule "CompensationType_7"
    when
    $ctx : Context(injury_type == "Death", injury_severity != null, injury_duration != null)
    then
    $ctx.setResult("DeathCompensation");
    $ctx.setLegalBasis("Section 99(1)");
    $ctx.setSourceText("Kuoleman korvaus");
end

// Decision: CompensationAmount
// Description: Calculate compensation amount
// Legal Source: Part III, Sections 36-109
// Inputs: compensation_type, income.annual, injury.severity, work_ability.lost_percentage
// Output: compensation_amount

rule "CompensationAmount_1"
    when
    $ctx : Context(compensation_type == "LostWages", income_annual != null, injury_severity != null, work_ability_lost_percentage == "100%")
    then
    $ctx.setResult("income.annual / 365 * days");
    $ctx.setLegalBasis("Section 56(1)");
    $ctx.setSourceText("Täysi ansionmenetys");
end

rule "CompensationAmount_2"
    when
    $ctx : Context(compensation_type == "LostWages", income_annual != null, injury_severity != null, work_ability_lost_percentage == "50%")
    then
    $ctx.setResult("income.annual / 365 * days * 0.5");
    $ctx.setLegalBasis("Section 56(2)");
    $ctx.setSourceText("Osittainen ansionmenetys");
end

rule "CompensationAmount_3"
    when
    $ctx : Context(compensation_type == "LostWages", income_annual != null, injury_severity != null, work_ability_lost_percentage == "0%")
    then
    $ctx.setResult("0");
    $ctx.setLegalBasis("Section 56");
    $ctx.setSourceText("Ei ansionmenetystä");
end

rule "CompensationAmount_4"
    when
    $ctx : Context(compensation_type == "PermanentDisability", income_annual != null, injury_severity == "10-19%", work_ability_lost_percentage != null)
    then
    $ctx.setResult("income.annual * 0.1");
    $ctx.setLegalBasis("Section 84(1)");
    $ctx.setSourceText("Haittalisä 10-19%");
end

rule "CompensationAmount_5"
    when
    $ctx : Context(compensation_type == "PermanentDisability", income_annual != null, injury_severity == "20-50%", work_ability_lost_percentage != null)
    then
    $ctx.setResult("income.annual * 0.2");
    $ctx.setLegalBasis("Section 84(1)");
    $ctx.setSourceText("Haittalisä 20-50%");
end

rule "CompensationAmount_6"
    when
    $ctx : Context(compensation_type == "PermanentDisability", income_annual != null, injury_severity == "51-100%", work_ability_lost_percentage != null)
    then
    $ctx.setResult("income.annual");
    $ctx.setLegalBasis("Section 84(2)");
    $ctx.setSourceText("Täysi haittalisä");
end

rule "CompensationAmount_7"
    when
    $ctx : Context(compensation_type == "Death", income_annual != null, injury_severity != null, work_ability_lost_percentage != null)
    then
    $ctx.setResult("Section 99-109 rates");
    $ctx.setLegalBasis("Sections 99-109");
    $ctx.setSourceText("Kuoleman korvaukset");
end

// Decision: MedicalCareCoverage
// Description: Determine medical care coverage
// Legal Source: Part III, Sections 36-54
// Inputs: treatment.type, treatment.necessity, treatment.provider
// Output: coverage

rule "MedicalCareCoverage_1"
    when
    $ctx : Context(treatment_type == "EmergencyCare", treatment_necessity == "required", treatment_provider == "public")
    then
    $ctx.setResult("100%");
    $ctx.setLegalBasis("Section 37(1)");
    $ctx.setSourceText("Julkisen terveydenhuollon hoito");
end

rule "MedicalCareCoverage_2"
    when
    $ctx : Context(treatment_type == "EmergencyCare", treatment_necessity == "required", treatment_provider == "private")
    then
    $ctx.setResult("100% (reimbursement)");
    $ctx.setLegalBasis("Section 37(2)");
    $ctx.setSourceText("Yksityisen hoidon korvaus");
end

rule "MedicalCareCoverage_3"
    when
    $ctx : Context(treatment_type == "Surgery", treatment_necessity == "required", treatment_provider != null)
    then
    $ctx.setResult("100%");
    $ctx.setLegalBasis("Section 38(1)");
    $ctx.setSourceText("Leikkaushoito");
end

rule "MedicalCareCoverage_4"
    when
    $ctx : Context(treatment_type == "Medicines", treatment_necessity == "prescribed", treatment_provider == "pharmacy")
    then
    $ctx.setResult("100% (drug list)");
    $ctx.setLegalBasis("Section 45");
    $ctx.setSourceText("Lääkkeet");
end

rule "MedicalCareCoverage_5"
    when
    $ctx : Context(treatment_type == "Rehabilitation", treatment_necessity == "medical_necessity", treatment_provider != null)
    then
    $ctx.setResult("100%");
    $ctx.setLegalBasis("Section 88(1)");
    $ctx.setSourceText("Kuntoutus");
end

rule "MedicalCareCoverage_6"
    when
    $ctx : Context(treatment_type == "DentalTreatment", treatment_necessity == "accident_related", treatment_provider != null)
    then
    $ctx.setResult("100%");
    $ctx.setLegalBasis("Section 48");
    $ctx.setSourceText("Hammashoito");
end

rule "MedicalCareCoverage_7"
    when
    $ctx : Context(treatment_type == "TravelToTreatment", treatment_necessity == "required", treatment_provider != null)
    then
    $ctx.setResult("Kilometre allowance");
    $ctx.setLegalBasis("Section 50");
    $ctx.setSourceText("Matkakustannukset");
end

rule "MedicalCareCoverage_8"
    when
    $ctx : Context(treatment_type == "Prosthesis", treatment_necessity == "required", treatment_provider != null)
    then
    $ctx.setResult("100%");
    $ctx.setLegalBasis("Section 47");
    $ctx.setSourceText("Silmälasit, proteesit");
end

// Decision: ClaimTimeLimit
// Description: Determine claim submission time limit
// Legal Source: Part IV, Section 110
// Inputs: claim.type, injury.timing
// Output: time_limit

rule "ClaimTimeLimit_1"
    when
    $ctx : Context(claim_type == "WorkAccident", injury_timing == "within_3_years")
    then
    $ctx.setResult("3 years from accident");
    $ctx.setLegalBasis("Section 110(1)");
    $ctx.setSourceText("3 vuoden määräaika");
end

rule "ClaimTimeLimit_2"
    when
    $ctx : Context(claim_type == "WorkAccident", injury_timing == "after_3_years")
    then
    $ctx.setResult("Claim barred");
    $ctx.setLegalBasis("Section 110(3)");
    $ctx.setSourceText("Määräajan umpeutuminen");
end

rule "ClaimTimeLimit_3"
    when
    $ctx : Context(claim_type == "OccupationalDisease", injury_timing != null)
    then
    $ctx.setResult("3 years from diagnosis");
    $ctx.setLegalBasis("Section 110(2)");
    $ctx.setSourceText("Ammattitaudin määräaika");
end

rule "ClaimTimeLimit_4"
    when
    $ctx : Context(claim_type == "DeathBenefit", injury_timing == "within_3_years")
    then
    $ctx.setResult("3 years from death");
    $ctx.setLegalBasis("Section 110(1)");
    $ctx.setSourceText("Kuoleman korvaus");
end

rule "ClaimTimeLimit_5"
    when
    $ctx : Context(claim_type == "SurvivorBenefit", injury_timing != null)
    then
    $ctx.setResult("3 years from death");
    $ctx.setLegalBasis("Section 110(1)");
    $ctx.setSourceText("Leskeneläke");
end

// Decision: RehabilitationEligibility
// Description: Determine rehabilitation eligibility
// Legal Source: Part III, Sections 88-98
// Inputs: injury.severity, work_ability.reduced, rehabilitation.medical_recommendation
// Output: eligible

rule "RehabilitationEligibility_1"
    when
    $ctx : Context(injury_severity == "severe", work_ability_reduced == "yes", rehabilitation_medical_recommendation == "yes")
    then
    $ctx.setResult("Full rehabilitation");
    $ctx.setLegalBasis("Section 88(1)");
    $ctx.setSourceText("Ammatillinen kuntoutus");
end

rule "RehabilitationEligibility_2"
    when
    $ctx : Context(injury_severity == "moderate", work_ability_reduced == "yes", rehabilitation_medical_recommendation == "yes")
    then
    $ctx.setResult("Vocational rehabilitation");
    $ctx.setLegalBasis("Section 89(1)");
    $ctx.setSourceText("Ammatillinen kuntoutus");
end

rule "RehabilitationEligibility_3"
    when
    $ctx : Context(injury_severity == "minor", work_ability_reduced == "no", rehabilitation_medical_recommendation == "no")
    then
    $ctx.setResult("Medical rehabilitation only");
    $ctx.setLegalBasis("Section 88(1)");
    $ctx.setSourceText("Lääkinnällinen kuntoutus");
end

rule "RehabilitationEligibility_4"
    when
    $ctx : Context(injury_severity != null, work_ability_reduced != null, rehabilitation_medical_recommendation == "no")
    then
    $ctx.setResult("Not eligible");
    $ctx.setLegalBasis("Section 88(1)");
    $ctx.setSourceText("Ei oikeutta kuntoutukseen");
end

// Decision: InsurancePremium
// Description: Calculate insurance premium
// Legal Source: Part V, Sections 156-186
// Inputs: employer.industry_risk, employer.payroll, employer.claims_history
// Output: premium

rule "InsurancePremium_1"
    when
    $ctx : Context(employer_industry_risk == "low_risk", employer_payroll != null, employer_claims_history == "no_claims")
    then
    $ctx.setResult("payroll * 0.005");
    $ctx.setLegalBasis("Section 166(1)");
    $ctx.setSourceText("Vakuutusmaksun peruste");
end

rule "InsurancePremium_2"
    when
    $ctx : Context(employer_industry_risk == "medium_risk", employer_payroll != null, employer_claims_history == "no_claims")
    then
    $ctx.setResult("payroll * 0.01");
    $ctx.setLegalBasis("Section 166(1)");
    $ctx.setSourceText("Vakuutusmaksun peruste");
end

rule "InsurancePremium_3"
    when
    $ctx : Context(employer_industry_risk == "high_risk", employer_payroll != null, employer_claims_history == "no_claims")
    then
    $ctx.setResult("payroll * 0.02");
    $ctx.setLegalBasis("Section 166(1)");
    $ctx.setSourceText("Korkea riski");
end

rule "InsurancePremium_4"
    when
    $ctx : Context(employer_industry_risk != null, employer_payroll != null, employer_claims_history == "with_claims")
    then
    $ctx.setResult("base_premium + risk loading");
    $ctx.setLegalBasis("Sections 171-176");
    $ctx.setSourceText("Lisämaksu");
end

// Decision: AppealsProcess
// Description: Determine appeals process
// Legal Source: Part VIII, Sections 237-247
// Inputs: decision.type, claimaint.disagreement
// Output: appeal_path

rule "AppealsProcess_1"
    when
    $ctx : Context(decision_type == "Rejection", claimaint_disagreement == "yes")
    then
    $ctx.setResult("Appeal to Insurance Company -> Accident Board");
    $ctx.setLegalBasis("Section 237(1)");
    $ctx.setSourceText("Valitus vakuutusyhtiölle");
end

rule "AppealsProcess_2"
    when
    $ctx : Context(decision_type == "AmountDispute", claimaint_disagreement == "yes")
    then
    $ctx.setResult("Appeal to Accident Compensation Board");
    $ctx.setLegalBasis("Section 238");
    $ctx.setSourceText("Tapaturma-asianlautakunta");
end

rule "AppealsProcess_3"
    when
    $ctx : Context(decision_type == "LateDecision", claimaint_disagreement == "yes")
    then
    $ctx.setResult("Complaint + Late interest");
    $ctx.setLegalBasis("Section 146");
    $ctx.setSourceText("Viivästyskorotus");
end

rule "AppealsProcess_4"
    when
    $ctx : Context(decision_type == "AnyDecision", claimaint_disagreement == "no")
    then
    $ctx.setResult("No appeal");
    $ctx.setLegalBasis("N/A");
    $ctx.setSourceText("Ei valitusta");
end

// Decision: SurvivorBenefits
// Description: Determine survivor benefit eligibility
// Legal Source: Part III, Sections 99-109
// Inputs: survivor.relationship, survivor.age, deceased.contributory
// Output: benefit

rule "SurvivorBenefits_1"
    when
    $ctx : Context(survivor_relationship == "Spouse", survivor_age != null, deceased_contributory == "yes")
    then
    $ctx.setResult("Spouse pension");
    $ctx.setLegalBasis("Section 100(1)");
    $ctx.setSourceText("Leskeneläke");
end

rule "SurvivorBenefits_2"
    when
    $ctx : Context(survivor_relationship == "Spouse", survivor_age != null, deceased_contributory == "no")
    then
    $ctx.setResult("Lump sum");
    $ctx.setLegalBasis("Section 107(1)");
    $ctx.setSourceText("Kertakorvaus");
end

rule "SurvivorBenefits_3"
    when
    $ctx : Context(survivor_relationship == "Child", survivor_age == "under_18", deceased_contributory == "yes")
    then
    $ctx.setResult("Child pension + orphan allowance");
    $ctx.setLegalBasis("Sections 101-102");
    $ctx.setSourceText("Lapseneläke");
end

rule "SurvivorBenefits_4"
    when
    $ctx : Context(survivor_relationship == "Child", survivor_age == "18-24_student", deceased_contributory == "yes")
    then
    $ctx.setResult("Student orphan pension");
    $ctx.setLegalBasis("Section 103");
    $ctx.setSourceText("Opiskelijan eläke");
end

rule "SurvivorBenefits_5"
    when
    $ctx : Context(survivor_relationship == "Dependent", survivor_age != null, deceased_contributory == "yes")
    then
    $ctx.setResult("Dependent allowance");
    $ctx.setLegalBasis("Section 105");
    $ctx.setSourceText("Huollettavan korvaus");
end
